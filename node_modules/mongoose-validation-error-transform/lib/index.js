'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = mongooseValidationErrorTransform;

var s = require('underscore.string');
var _ = require('lodash');

function mongooseValidationErrorTransform(schema, options) {

  options = _.defaults(options || {}, {
    capitalize: true,
    humanize: true,
    transform: function transform(messages) {
      return messages.join(', ');
    }
  });

  function humanizePath(err, doc, next) {

    if (err.name !== 'ValidationError' || !_.isObject(err.errors)) return next(err);

    err.message = options.transform(_.map(_.values(err.errors), function (error) {
      if (!_.isString(error.path)) return options.capitalize ? s.capitalize(error.message) : error.message;
      if (options.humanize) error.message = error.message.replace(new RegExp(error.path, 'g'), s.humanize(error.path));
      if (options.capitalize) error.message = s.capitalize(error.message);
      return error.message;
    }));

    next(err);
  }

  schema.post('save', humanizePath);
  schema.post('update', humanizePath);
  schema.post('findOneAndUpdate', humanizePath);
  schema.post('insertMany', humanizePath);

  return schema;
}
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC5qcyJdLCJuYW1lcyI6WyJtb25nb29zZVZhbGlkYXRpb25FcnJvclRyYW5zZm9ybSIsInMiLCJyZXF1aXJlIiwiXyIsInNjaGVtYSIsIm9wdGlvbnMiLCJkZWZhdWx0cyIsImNhcGl0YWxpemUiLCJodW1hbml6ZSIsInRyYW5zZm9ybSIsIm1lc3NhZ2VzIiwiam9pbiIsImh1bWFuaXplUGF0aCIsImVyciIsImRvYyIsIm5leHQiLCJuYW1lIiwiaXNPYmplY3QiLCJlcnJvcnMiLCJtZXNzYWdlIiwibWFwIiwidmFsdWVzIiwiaXNTdHJpbmciLCJlcnJvciIsInBhdGgiLCJyZXBsYWNlIiwiUmVnRXhwIiwicG9zdCJdLCJtYXBwaW5ncyI6Ijs7Ozs7a0JBSXdCQSxnQzs7QUFIeEIsSUFBTUMsSUFBSUMsUUFBUSxtQkFBUixDQUFWO0FBQ0EsSUFBTUMsSUFBSUQsUUFBUSxRQUFSLENBQVY7O0FBRWUsU0FBU0YsZ0NBQVQsQ0FBMENJLE1BQTFDLEVBQWtEQyxPQUFsRCxFQUEyRDs7QUFFeEVBLFlBQVVGLEVBQUVHLFFBQUYsQ0FBV0QsV0FBVyxFQUF0QixFQUEwQjtBQUNsQ0UsZ0JBQVksSUFEc0I7QUFFbENDLGNBQVUsSUFGd0I7QUFHbENDLGVBQVc7QUFBQSxhQUFZQyxTQUFTQyxJQUFULENBQWMsSUFBZCxDQUFaO0FBQUE7QUFIdUIsR0FBMUIsQ0FBVjs7QUFNQSxXQUFTQyxZQUFULENBQXNCQyxHQUF0QixFQUEyQkMsR0FBM0IsRUFBZ0NDLElBQWhDLEVBQXNDOztBQUVwQyxRQUFJRixJQUFJRyxJQUFKLEtBQWEsaUJBQWIsSUFBa0MsQ0FBQ2IsRUFBRWMsUUFBRixDQUFXSixJQUFJSyxNQUFmLENBQXZDLEVBQ0UsT0FBT0gsS0FBS0YsR0FBTCxDQUFQOztBQUVGQSxRQUFJTSxPQUFKLEdBQWNkLFFBQVFJLFNBQVIsQ0FBa0JOLEVBQUVpQixHQUFGLENBQzlCakIsRUFBRWtCLE1BQUYsQ0FBU1IsSUFBSUssTUFBYixDQUQ4QixFQUU5QixpQkFBUztBQUNQLFVBQUksQ0FBQ2YsRUFBRW1CLFFBQUYsQ0FBV0MsTUFBTUMsSUFBakIsQ0FBTCxFQUNFLE9BQU9uQixRQUFRRSxVQUFSLEdBQXFCTixFQUFFTSxVQUFGLENBQWFnQixNQUFNSixPQUFuQixDQUFyQixHQUFtREksTUFBTUosT0FBaEU7QUFDRixVQUFJZCxRQUFRRyxRQUFaLEVBQ0VlLE1BQU1KLE9BQU4sR0FBZ0JJLE1BQU1KLE9BQU4sQ0FBY00sT0FBZCxDQUNkLElBQUlDLE1BQUosQ0FBV0gsTUFBTUMsSUFBakIsRUFBdUIsR0FBdkIsQ0FEYyxFQUVkdkIsRUFBRU8sUUFBRixDQUFXZSxNQUFNQyxJQUFqQixDQUZjLENBQWhCO0FBSUYsVUFBSW5CLFFBQVFFLFVBQVosRUFDRWdCLE1BQU1KLE9BQU4sR0FBZ0JsQixFQUFFTSxVQUFGLENBQWFnQixNQUFNSixPQUFuQixDQUFoQjtBQUNGLGFBQU9JLE1BQU1KLE9BQWI7QUFDRCxLQWI2QixDQUFsQixDQUFkOztBQWdCQUosU0FBS0YsR0FBTDtBQUVEOztBQUVEVCxTQUFPdUIsSUFBUCxDQUFZLE1BQVosRUFBb0JmLFlBQXBCO0FBQ0FSLFNBQU91QixJQUFQLENBQVksUUFBWixFQUFzQmYsWUFBdEI7QUFDQVIsU0FBT3VCLElBQVAsQ0FBWSxrQkFBWixFQUFnQ2YsWUFBaEM7QUFDQVIsU0FBT3VCLElBQVAsQ0FBWSxZQUFaLEVBQTBCZixZQUExQjs7QUFFQSxTQUFPUixNQUFQO0FBRUQiLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJcbmNvbnN0IHMgPSByZXF1aXJlKCd1bmRlcnNjb3JlLnN0cmluZycpO1xuY29uc3QgXyA9IHJlcXVpcmUoJ2xvZGFzaCcpO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBtb25nb29zZVZhbGlkYXRpb25FcnJvclRyYW5zZm9ybShzY2hlbWEsIG9wdGlvbnMpIHtcblxuICBvcHRpb25zID0gXy5kZWZhdWx0cyhvcHRpb25zIHx8IHt9LCB7XG4gICAgY2FwaXRhbGl6ZTogdHJ1ZSxcbiAgICBodW1hbml6ZTogdHJ1ZSxcbiAgICB0cmFuc2Zvcm06IG1lc3NhZ2VzID0+IG1lc3NhZ2VzLmpvaW4oJywgJylcbiAgfSk7XG5cbiAgZnVuY3Rpb24gaHVtYW5pemVQYXRoKGVyciwgZG9jLCBuZXh0KSB7XG5cbiAgICBpZiAoZXJyLm5hbWUgIT09ICdWYWxpZGF0aW9uRXJyb3InIHx8ICFfLmlzT2JqZWN0KGVyci5lcnJvcnMpKVxuICAgICAgcmV0dXJuIG5leHQoZXJyKTtcblxuICAgIGVyci5tZXNzYWdlID0gb3B0aW9ucy50cmFuc2Zvcm0oXy5tYXAoXG4gICAgICBfLnZhbHVlcyhlcnIuZXJyb3JzKSxcbiAgICAgIGVycm9yID0+IHtcbiAgICAgICAgaWYgKCFfLmlzU3RyaW5nKGVycm9yLnBhdGgpKVxuICAgICAgICAgIHJldHVybiBvcHRpb25zLmNhcGl0YWxpemUgPyBzLmNhcGl0YWxpemUoZXJyb3IubWVzc2FnZSkgOiBlcnJvci5tZXNzYWdlO1xuICAgICAgICBpZiAob3B0aW9ucy5odW1hbml6ZSlcbiAgICAgICAgICBlcnJvci5tZXNzYWdlID0gZXJyb3IubWVzc2FnZS5yZXBsYWNlKFxuICAgICAgICAgICAgbmV3IFJlZ0V4cChlcnJvci5wYXRoLCAnZycpLFxuICAgICAgICAgICAgcy5odW1hbml6ZShlcnJvci5wYXRoKVxuICAgICAgICAgICk7XG4gICAgICAgIGlmIChvcHRpb25zLmNhcGl0YWxpemUpXG4gICAgICAgICAgZXJyb3IubWVzc2FnZSA9IHMuY2FwaXRhbGl6ZShlcnJvci5tZXNzYWdlKTtcbiAgICAgICAgcmV0dXJuIGVycm9yLm1lc3NhZ2U7XG4gICAgICB9XG4gICAgKSk7XG5cbiAgICBuZXh0KGVycik7XG5cbiAgfVxuXG4gIHNjaGVtYS5wb3N0KCdzYXZlJywgaHVtYW5pemVQYXRoKTtcbiAgc2NoZW1hLnBvc3QoJ3VwZGF0ZScsIGh1bWFuaXplUGF0aCk7XG4gIHNjaGVtYS5wb3N0KCdmaW5kT25lQW5kVXBkYXRlJywgaHVtYW5pemVQYXRoKTtcbiAgc2NoZW1hLnBvc3QoJ2luc2VydE1hbnknLCBodW1hbml6ZVBhdGgpO1xuXG4gIHJldHVybiBzY2hlbWE7XG5cbn1cbiJdfQ==